<!DOCTYPE html>

<html lang="ru">

<head>
    <title>I2C tools</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <style>
        .column {
            float: left;
            width: 100%;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .btn {
            float: left;
            width: 100%;
            margin: 2px;

        }

        .cl1 {
            float: left;
            width: 100%;
            margin: 2px;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .cl01 {
            float: left;
            width: 100%;
            text-align: center;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .cl02 {
            float: left;
            width: 48%;
            text-align: center;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .cl03 {
            float: left;
            width: 32%;
            text-align: center;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .cl04 {
            float: left;
            width: 24%;
            text-align: center;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .cl05 {
            float: left;
            width: 19%;
            text-align: center;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .hdr {
            float: left;
            width: 100%;
            text-align: center;
            color: white;
            background-color: blue;
            padding: 5px;
            margin: 5px;
        }
    </style>

</head>

<body>
    <div class="hdr">Go Home</div>

    <div class="column">
        <button class="btn" id="goHome">Home Page</button>
    </div>


    <div class="cl1">
        <div class="cl05">
            <label class="cl01" for="i2cPortConfig">I2C Port</label>
            <select class="cl01" id="i2cPortConfig">
                <option value="0" selected>0</option>
                <option value="1">1</option>
            </select>
        </div>

        <div class="cl05">
            <label class="cl01" for="i2cSCLConfig">GPIO SCL</label>
            <select class="cl01" id="i2cSCLConfig">
                <option value="0" selected>0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
                <option value="25">25</option>
                <option value="26">26</option>
                <option value="27">27</option>
                <option value="28">28</option>
                <option value="29">29</option>
                <option value="30">30</option>
                <option value="31">31</option>
                <option value="32">32</option>
                <option value="33">33</option>
                <option value="34">34</option>
                <option value="35">35</option>
                <option value="36">36</option>
                <option value="37">37</option>
                <option value="38">38</option>
                <option value="39">39</option>
                <option value="40">40</option>
                <option value="41">41</option>
                <option value="42">42</option>
                <option value="43">43</option>
                <option value="44">44</option>
                <option value="45">45</option>
                <option value="46">46</option>
                <option value="47">47</option>
                <option value="48">48</option>
            </select>
        </div>

        <div class="cl05">
            <label class="cl01" for="i2cSDAConfig">GPIO SDA</label>
            <select class="cl01" id="i2cSDAConfig">
                <option value="0" selected>0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
                <option value="25">25</option>
                <option value="26">26</option>
                <option value="27">27</option>
                <option value="28">28</option>
                <option value="29">29</option>
                <option value="30">30</option>
                <option value="31">31</option>
                <option value="32">32</option>
                <option value="33">33</option>
                <option value="34">34</option>
                <option value="35">35</option>
                <option value="36">36</option>
                <option value="37">37</option>
                <option value="38">38</option>
                <option value="39">39</option>
                <option value="40">40</option>
                <option value="41">41</option>
                <option value="42">42</option>
                <option value="43">43</option>
                <option value="44">44</option>
                <option value="45">45</option>
                <option value="46">46</option>
                <option value="47">47</option>
                <option value="48">48</option>
            </select>
        </div>

        <div class="cl05">
            <label class="cl01" for="i2cFREQConfig">I2C Frequence</label>
            <select class="cl01" id="i2cFREQConfig">
                <option value="10000">10000</option>
                <option value="25000">25000</option>
                <option value="50000">50000</option>
                <option value="100000" selected>100000</option>
                <option value="400000">400000</option>
            </select>
        </div>
        <div class="cl05">
            <label class="cl01" for="i2cTrigConfig">Trigger GPIO</label>
            <select class="cl01" id="i2cTrigConfig">
                <option value="-1" selected>Disable</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
                <option value="25">25</option>
                <option value="26">26</option>
                <option value="27">27</option>
                <option value="28">28</option>
                <option value="29">29</option>
                <option value="30">30</option>
                <option value="31">31</option>
                <option value="32">32</option>
                <option value="33">33</option>
                <option value="34">34</option>
                <option value="35">35</option>
                <option value="36">36</option>
                <option value="37">37</option>
                <option value="38">38</option>
                <option value="39">39</option>
                <option value="40">40</option>
                <option value="41">41</option>
                <option value="42">42</option>
                <option value="43">43</option>
                <option value="44">44</option>
                <option value="45">45</option>
                <option value="46">46</option>
                <option value="47">47</option>
                <option value="48">48</option>
            </select>
        </div>


    </div>

    <div class="column">
        <button class="btn" id="i2cScanDev">I2C Scan devices on the bus</button>
    </div>
    <div class="cl1">
        <div class="cl04">
            <label class="cl01" for="i2cChipAddress">I2C Chip Address</label>
            <input type="number" class="cl01" id="i2cChipAddress" min="0" max="127" value="1">
        </div>
        <div class="cl04">
            <label class="cl01" for="i2cDumpSize">I2C size of each read </label>
            <input type="number" class="cl01" id="i2cDumpSize" min="1" value="1">
        </div>
    </div>
    <div class="column">
        <button class="btn" id="i2cDumpRegs">Examine registers</button>
    </div>

    <div class="cl1">
        <div class="cl04">
            <label class="cl01" for="i2cRegisterGetAddress">I2C Register Address</label>
            <input type="number" class="cl01" id="i2cRegisterGetAddress" min="0" max="255" value="1">
        </div>
        <div class="cl04">
            <label class="cl01" for="i2cRegisterGetSize">I2C size of each read </label>
            <input type="number" class="cl01" id="i2cRegisterGetSize" min="1" value="1">
        </div>
    </div>
    <div class="column">
        <button class="btn" id="i2cGetRegister">Read register</button>
    </div>

    <div class="cl1">
        <div class="cl04">
            <label class="cl01" for="i2cRegisterSetAddress">I2C Register Address</label>
            <input type="number" class="cl01" id="i2cRegisterSetAddress" min="0" max="255" value="1">
        </div>
        <div class="cl04">
            <label class="cl01" for="i2cRegisterSetSize">I2C size of Data </label>
            <input type="number" class="cl01" id="i2cRegisterSetSize" min="1" value="1">
        </div>
        <div class="cl02">
            <label class="cl01" for="i2cRegisterSetData">I2C Data to set </label>
            <input class="cl01" id="i2cRegisterSetData">
        </div>

    </div>
    <div class="column">
        <button class="btn" id="i2cSetRegister">Set register</button>
    </div>

    <div id="LogArea" class="cl1">
        <textarea id="logtext" rows="24" cols="80"></textarea>
    </div>

    <script>
        document.getElementById("i2cScanDev").addEventListener("click", function (e) {
            send_config_data();
            sock_send(JSON.stringify({ name: "ScanCmd", msg: "ScanCmd" }));
        });

        document.getElementById("i2cDumpRegs").addEventListener("click", function (e) {
            send_config_data();
            sock_send(JSON.stringify({ name: "i2cChipAddress", msg: document.getElementById("i2cChipAddress").value }));
            sock_send(JSON.stringify({ name: "i2cDumpSize", msg: document.getElementById("i2cDumpSize").value }));
            sock_send(JSON.stringify({ name: "DumpCmd", msg: "DumpCmd" }));
        });

        document.getElementById("i2cGetRegister").addEventListener("click", function (e) {
            send_config_data();
            sock_send(JSON.stringify({ name: "i2cChipAddress", msg: document.getElementById("i2cChipAddress").value }));
            sock_send(JSON.stringify({ name: "i2cRegisterGetAddress", msg: document.getElementById("i2cRegisterGetAddress").value }));
            sock_send(JSON.stringify({ name: "i2cRegisterGetSize", msg: document.getElementById("i2cRegisterGetSize").value }));
            sock_send(JSON.stringify({ name: "GetCmd", msg: "GetCmd" }));
        });

        document.getElementById("i2cSetRegister").addEventListener("click", function (e) {
            send_config_data();
            sock_send(JSON.stringify({ name: "i2cChipAddress", msg: document.getElementById("i2cChipAddress").value }));
            sock_send(JSON.stringify({ name: "i2cRegisterSetAddress", msg: document.getElementById("i2cRegisterSetAddress").value }));
            sock_send(JSON.stringify({ name: "i2cRegisterSetSize", msg: document.getElementById("i2cRegisterSetSize").value }));
            sock_send(JSON.stringify({ name: "i2cRegisterSetData", msg: document.getElementById("i2cRegisterSetData").value }));
            sock_send(JSON.stringify({ name: "SetCmd", msg: "SetCmd" }));
        });
        document.getElementById("goHome").addEventListener("click", function (e) {
        //onclick="window.location.href = '/'"
        socket.close();
        window.location.href = '/';
                });

        function send_config_data() {
            sock_send(JSON.stringify({ name: "i2cPortConfig", msg: document.getElementById("i2cPortConfig").value }));
            sock_send(JSON.stringify({ name: "i2cSCLConfig", msg: document.getElementById("i2cSCLConfig").value }));
            sock_send(JSON.stringify({ name: "i2cSDAConfig", msg: document.getElementById("i2cSDAConfig").value }));
            sock_send(JSON.stringify({ name: "i2cFREQConfig", msg: document.getElementById("i2cFREQConfig").value }));
            sock_send(JSON.stringify({ name: "i2cTrigConfig", msg: document.getElementById("i2cTrigConfig").value }));
        }
        function receiveWsData(data) {
            try {
                let obj = JSON.parse(data);
                console.log(obj);
                }
            catch
                {
                console.log("catch" + data);
                textstr.value = textstr.value + "Reseive"  + data + '\n';
                }
        }
    </script>

    <script>  // Прием, обработка и отправка данных в WS
    </script>

    <script> // основной старт скрипта, открыть сокет
        // создать сокет по адресу
        let protocol = "ws:"
        if(document.location.protocol == "https:") protocol = "wss:"
        let wsHostStr = protocol + "//" + document.location.host + document.location.pathname;
        wsHostStr += (document.location.pathname == '/') ? "ws" : "/ws";
        var socket = new WebSocket(wsHostStr);
        let textstr = document.getElementById("logtext");
    </script>

    <script> // события WS
        
            // socket.send -> test only
            function sock_send(e) {
                socket.send(e);
                console.log(e);
                textstr.value = textstr.value + "Send " + e + '\n' ;
            };

            socket.onopen = function () {
                console.log("connect");
            };
            socket.onclose = function (event) {
                console.log("close");
//                setTimeout(() => document.location.reload(), 2000);
            };
            socket.onerror = function () {
                console.log("error");
//                setTimeout(() => document.location.reload(), 2000);
            };
            socket.onmessage = function (event) {
                receiveWsData(event.data);
            };
    </script>

</body>

</html>